{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2014 IBM Corp. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar axios_1 = require(\"axios\");\n\nvar axios_cookiejar_support_1 = require(\"axios-cookiejar-support\");\n\nvar extend = require(\"extend\");\n\nvar FormData = require(\"form-data\");\n\nvar https = require(\"https\");\n\nvar isStream = require(\"isstream\");\n\nvar querystring = require(\"querystring\");\n\nvar zlib = require(\"zlib\");\n\nvar helper_1 = require(\"./helper\");\n\nvar logger_1 = require(\"./logger\");\n\nvar stream_to_promise_1 = require(\"./stream-to-promise\");\n\nvar isBrowser = typeof window === 'object';\nvar globalTransactionId = 'x-global-transaction-id';\n\nvar RequestWrapper =\n/** @class */\nfunction () {\n  function RequestWrapper(axiosOptions) {\n    axiosOptions = axiosOptions || {};\n    this.compressRequestData = Boolean(axiosOptions.enableGzipCompression); // override several axios defaults\n    // axios sets the default Content-Type for `post`, `put`, and `patch` operations\n    // to 'application/x-www-form-urlencoded'. This causes problems, so overriding the\n    // defaults here\n\n    var axiosConfig = {\n      maxContentLength: Infinity,\n      headers: {\n        post: {\n          'Content-Type': 'application/json'\n        },\n        put: {\n          'Content-Type': 'application/json'\n        },\n        patch: {\n          'Content-Type': 'application/json'\n        }\n      }\n    }; // merge axios config into default\n\n    extend(true, axiosConfig, axiosOptions); // if the user explicitly sets `disableSslVerification` to true,\n    // `rejectUnauthorized` must be set to false in the https agent\n\n    if (axiosOptions.disableSslVerification === true) {\n      // the user may have already provided a custom agent. if so, update it\n      if (axiosConfig.httpsAgent) {\n        // check for presence of `options` field for \"type safety\"\n        if (axiosConfig.httpsAgent.options) {\n          axiosConfig.httpsAgent.options.rejectUnauthorized = false;\n        }\n      } else {\n        // if no agent is present, create a new one\n        axiosConfig.httpsAgent = new https.Agent({\n          rejectUnauthorized: false\n        });\n      }\n    }\n\n    this.axiosInstance = axios_1.default.create(axiosConfig); // if a cookie jar is provided, wrap the axios instance and update defaults\n\n    if (axiosOptions.jar) {\n      axios_cookiejar_support_1.default(this.axiosInstance);\n      this.axiosInstance.defaults.withCredentials = true;\n      this.axiosInstance.defaults.jar = axiosOptions.jar;\n    } // set debug interceptors\n\n\n    if (process.env.NODE_DEBUG === 'axios' || process.env.DEBUG) {\n      this.axiosInstance.interceptors.request.use(function (config) {\n        logger_1.default.debug('Request:');\n\n        try {\n          logger_1.default.debug(JSON.stringify(config, null, 2));\n        } catch (_a) {\n          logger_1.default.error(config);\n        }\n\n        return config;\n      }, function (error) {\n        logger_1.default.error('Error: ');\n\n        try {\n          logger_1.default.error(JSON.stringify(error, null, 2));\n        } catch (_a) {\n          logger_1.default.error(error);\n        }\n\n        return Promise.reject(error);\n      });\n      this.axiosInstance.interceptors.response.use(function (response) {\n        logger_1.default.debug('Response:');\n\n        try {\n          logger_1.default.debug(JSON.stringify(response, null, 2));\n        } catch (_a) {\n          logger_1.default.error(response);\n        }\n\n        return response;\n      }, function (error) {\n        logger_1.default.error('Error: ');\n\n        try {\n          logger_1.default.error(JSON.stringify(error, null, 2));\n        } catch (_a) {\n          logger_1.default.error(error);\n        }\n\n        return Promise.reject(error);\n      });\n    }\n  }\n  /**\n   * Creates the request.\n   * 1. Merge default options with user provided options\n   * 2. Checks for missing parameters\n   * 3. Encode path and query parameters\n   * 4. Call the api\n   * @private\n   * @returns {ReadableStream|undefined}\n   * @throws {Error}\n   */\n\n\n  RequestWrapper.prototype.sendRequest = function (parameters) {\n    return __awaiter(this, void 0, void 0, function () {\n      var options, path, body, form, formData, qs, method, serviceUrl, headers, url, multipartForm, data, requestParams;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            options = extend(true, {}, parameters.defaultOptions, parameters.options);\n            path = options.path, body = options.body, form = options.form, formData = options.formData, qs = options.qs, method = options.method, serviceUrl = options.serviceUrl;\n            headers = options.headers, url = options.url;\n            multipartForm = new FormData(); // Form params\n\n            if (formData) {\n              Object.keys(formData).forEach(function (key) {\n                var values = Array.isArray(formData[key]) ? formData[key] : [formData[key]]; // Skip keys with undefined/null values or empty object value\n\n                values.filter(function (v) {\n                  return v != null && !helper_1.isEmptyObject(v);\n                }).forEach(function (value) {\n                  // Special case of empty file object\n                  if (value.hasOwnProperty('contentType') && !value.hasOwnProperty('data')) {\n                    return;\n                  }\n\n                  if (helper_1.isFileWithMetadata(value)) {\n                    var fileObj = helper_1.buildRequestFileObject(value);\n                    multipartForm.append(key, fileObj.value, fileObj.options);\n                  } else {\n                    if (typeof value === 'object' && !helper_1.isFileData(value)) {\n                      value = JSON.stringify(value);\n                    }\n\n                    multipartForm.append(key, value);\n                  }\n                });\n              });\n            } // Path params\n\n\n            url = parsePath(url, path); // Headers\n\n            options.headers = Object.assign({}, options.headers); // Convert array-valued query params to strings\n\n            if (qs && Object.keys(qs).length > 0) {\n              Object.keys(qs).forEach(function (key) {\n                return Array.isArray(qs[key]) && (qs[key] = qs[key].join(','));\n              });\n            } // Add service default endpoint if options.url start with /\n\n\n            if (url && url.charAt(0) === '/') {\n              url = helper_1.stripTrailingSlash(serviceUrl) + url;\n            }\n\n            url = helper_1.stripTrailingSlash(url);\n            data = body;\n\n            if (form) {\n              data = querystring.stringify(form);\n              headers['Content-type'] = 'application/x-www-form-urlencoded';\n            }\n\n            if (formData) {\n              data = multipartForm; // form-data generates headers that MUST be included or the request will fail\n\n              headers = extend(true, {}, headers, multipartForm.getHeaders());\n            } // accept gzip encoded responses if Accept-Encoding is not already set\n\n\n            headers['Accept-Encoding'] = headers['Accept-Encoding'] || 'gzip';\n            if (!this.compressRequestData) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.gzipRequestBody(data, headers)];\n\n          case 1:\n            data = _a.sent();\n            _a.label = 2;\n\n          case 2:\n            requestParams = {\n              url: url,\n              method: method,\n              headers: headers,\n              params: qs,\n              data: data,\n              responseType: options.responseType || 'json',\n              paramsSerializer: function (params) {\n                return querystring.stringify(params);\n              }\n            };\n            return [2\n            /*return*/\n            , this.axiosInstance(requestParams).then(function (res) {\n              // sometimes error responses will still trigger the `then` block - escape that behavior here\n              if (!res) {\n                return;\n              }\n\n              ; // these objects contain circular json structures and are not always relevant to the user\n              // if the user wants them, they can be accessed through the debug properties\n\n              delete res.config;\n              delete res.request; // the other sdks use the interface `result` for the body\n\n              res.result = res.data;\n              delete res.data; // return another promise that resolves with 'res' to be handled in generated code\n\n              return res;\n            }, function (err) {\n              // return another promise that rejects with 'err' to be handled in generated code\n              throw _this.formatError(err);\n            })];\n        }\n      });\n    });\n  };\n  /**\n   * Format error returned by axios\n   * @param  {object} the object returned by axios via rejection\n   * @private\n   * @returns {Error}\n   */\n\n\n  RequestWrapper.prototype.formatError = function (axiosError) {\n    // return an actual error object,\n    // but make it flexible so we can add properties like 'body'\n    var error = new Error(); // axios specific handling\n    // this branch is for an error received from the service\n\n    if (axiosError.response) {\n      axiosError = axiosError.response; // The request was made and the server responded with a status code\n      // that falls out of the range of 2xx\n\n      delete axiosError.config;\n      delete axiosError.request;\n      error.statusText = axiosError.statusText;\n      error.name = axiosError.statusText; // ** deprecated **\n\n      error.status = axiosError.status;\n      error.code = axiosError.status; // ** deprecated **\n\n      error.message = parseServiceErrorMessage(axiosError.data) || axiosError.statusText; // some services bury the useful error message within 'data'\n      // adding it to the error under the key 'body' as a string or object\n\n      var errorBody = void 0;\n\n      try {\n        // try/catch to handle objects with circular references\n        errorBody = JSON.stringify(axiosError.data);\n      } catch (e) {\n        // ignore the error, use the object, and tack on a warning\n        errorBody = axiosError.data;\n        errorBody.warning = 'Body contains circular reference';\n        logger_1.default.error(\"Failed to stringify axiosError: \" + e);\n      }\n\n      error.body = errorBody; // attach headers to error object\n\n      error.headers = axiosError.headers; // print a more descriptive error message for auth issues\n\n      if (isAuthenticationError(axiosError)) {\n        error.message = 'Access is denied due to invalid credentials.';\n      }\n    } else if (axiosError.request) {\n      // The request was made but no response was received\n      // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n      // http.ClientRequest in node.js\n      error.message = axiosError.message;\n      error.statusText = axiosError.code;\n      error.body = 'Response not received - no connection was made to the service.'; // when a request to a private cloud instance has an ssl problem, it never connects and follows this branch of the error handling\n\n      if (isSelfSignedCertificateError(axiosError)) {\n        error.message = \"The connection failed because the SSL certificate is not valid. \" + \"To use a self-signed certificate, set the `disableSslVerification` parameter in the constructor options.\";\n      }\n    } else {\n      // Something happened in setting up the request that triggered an Error\n      error.message = axiosError.message;\n    }\n\n    return error;\n  };\n\n  RequestWrapper.prototype.gzipRequestBody = function (data, headers) {\n    return __awaiter(this, void 0, void 0, function () {\n      var contentSetToGzip, reqBuffer, _a, _b, err_1;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            contentSetToGzip = headers['Content-Encoding'] && headers['Content-Encoding'].toString().includes('gzip');\n\n            if (!data || contentSetToGzip) {\n              return [2\n              /*return*/\n              , data];\n            }\n\n            _c.label = 1;\n\n          case 1:\n            _c.trys.push([1, 5,, 6]);\n\n            if (!isStream(data)) return [3\n            /*break*/\n            , 3];\n            _b = (_a = Buffer).from;\n            return [4\n            /*yield*/\n            , stream_to_promise_1.streamToPromise(data)];\n\n          case 2:\n            reqBuffer = _b.apply(_a, [_c.sent()]);\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            if (data.toString && data.toString() !== '[object Object]' && !Array.isArray(data)) {\n              // this handles pretty much any primitive that isnt a JSON object or array\n              reqBuffer = Buffer.from(data.toString());\n            } else {\n              reqBuffer = Buffer.from(JSON.stringify(data));\n            }\n\n            _c.label = 4;\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _c.sent();\n            logger_1.default.error('Error converting request body to a buffer - data will not be compressed.');\n            logger_1.default.debug(err_1);\n            return [2\n            /*return*/\n            , data];\n\n          case 6:\n            try {\n              data = zlib.gzipSync(reqBuffer); // update the headers by reference - only if the data was actually compressed\n\n              headers['Content-Encoding'] = 'gzip';\n            } catch (err) {\n              // if an exception is caught, `data` will still be in its original form\n              // we can just proceed with the request uncompressed\n              logger_1.default.error('Error compressing request body - data will not be compressed.');\n              logger_1.default.debug(err);\n            }\n\n            return [2\n            /*return*/\n            , data];\n        }\n      });\n    });\n  };\n\n  return RequestWrapper;\n}();\n\nexports.RequestWrapper = RequestWrapper;\n/**\n * @private\n * @param {string} path\n * @param {Object} params\n * @returns {string}\n */\n\nfunction parsePath(path, params) {\n  if (!path || !params) {\n    return path;\n  }\n\n  return Object.keys(params).reduce(function (parsedPath, param) {\n    var value = encodeURIComponent(params[param]);\n    return parsedPath.replace(new RegExp(\"{\" + param + \"}\"), value);\n  }, path);\n}\n/**\n * Determine if the error is due to bad credentials\n * @private\n * @param {Object} error - error object returned from axios\n * @returns {boolean} true if error is due to authentication\n */\n\n\nfunction isAuthenticationError(error) {\n  var isAuthErr = false;\n  var code = error.status || null;\n  var body = error.data || {}; // handle specific error from iam service, should be relevant across platforms\n\n  var isIamServiceError = body.context && body.context.url && body.context.url.indexOf('iam') > -1;\n\n  if (code === 401 || code === 403 || isIamServiceError) {\n    isAuthErr = true;\n  }\n\n  return isAuthErr;\n}\n/**\n * Determine if the error is due to a bad self signed certificate\n * @private\n * @param {Object} error - error object returned from axios\n * @returns {boolean} true if error is due to an SSL error\n */\n\n\nfunction isSelfSignedCertificateError(error) {\n  var result = false;\n  var sslCode = 'DEPTH_ZERO_SELF_SIGNED_CERT';\n  var sslMessage = 'self signed certificate';\n  var hasSslCode = error.code === sslCode;\n  var hasSslMessage = hasStringProperty(error, 'message') && error.message.includes(sslMessage);\n\n  if (hasSslCode || hasSslMessage) {\n    result = true;\n  }\n\n  return result;\n}\n/**\n * Return true if object has a specified property that is a string\n * @private\n * @param {Object} obj - object to look for property in\n * @param {string} property - name of the property to look for\n * @returns {boolean} true if property exists and is string\n */\n\n\nfunction hasStringProperty(obj, property) {\n  return Boolean(obj[property] && typeof obj[property] === 'string');\n}\n/**\n * Look for service error message in common places, by priority\n * first look in `errors[0].message`, then in `error`, then in\n * `message`, then in `errorMessage`\n * @private\n * @param {Object} response - error response body received from service\n * @returns {string | undefined} the error message if is was found, undefined otherwise\n */\n\n\nfunction parseServiceErrorMessage(response) {\n  var message;\n\n  if (Array.isArray(response.errors) && response.errors.length > 0 && hasStringProperty(response.errors[0], 'message')) {\n    message = response.errors[0].message;\n  } else if (hasStringProperty(response, 'error')) {\n    message = response.error;\n  } else if (hasStringProperty(response, 'message')) {\n    message = response.message;\n  } else if (hasStringProperty(response, 'errorMessage')) {\n    message = response.errorMessage;\n  }\n\n  logger_1.default.info(\"Parsing service error message: \" + message);\n  return message;\n}","map":{"version":3,"sources":["/Users/sudesh/Documents/DEV2021/wacode/discovery-components/node_modules/ibm-cloud-sdk-core/lib/request-wrapper.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","Object","defineProperty","exports","axios_1","require","axios_cookiejar_support_1","extend","FormData","https","isStream","querystring","zlib","helper_1","logger_1","stream_to_promise_1","isBrowser","window","globalTransactionId","RequestWrapper","axiosOptions","compressRequestData","Boolean","enableGzipCompression","axiosConfig","maxContentLength","Infinity","headers","post","put","patch","disableSslVerification","httpsAgent","options","rejectUnauthorized","Agent","axiosInstance","default","create","jar","defaults","withCredentials","process","env","NODE_DEBUG","DEBUG","interceptors","request","use","config","debug","JSON","stringify","_a","error","response","prototype","sendRequest","parameters","path","form","formData","qs","method","serviceUrl","url","multipartForm","data","requestParams","_this","defaultOptions","keys","forEach","key","values","Array","isArray","filter","isEmptyObject","hasOwnProperty","isFileWithMetadata","fileObj","buildRequestFileObject","append","isFileData","parsePath","assign","join","charAt","stripTrailingSlash","getHeaders","gzipRequestBody","params","responseType","paramsSerializer","res","err","formatError","axiosError","Error","statusText","name","status","code","message","parseServiceErrorMessage","errorBody","warning","isAuthenticationError","isSelfSignedCertificateError","contentSetToGzip","reqBuffer","_b","err_1","_c","toString","includes","Buffer","from","streamToPromise","gzipSync","reduce","parsedPath","param","encodeURIComponent","replace","RegExp","isAuthErr","isIamServiceError","context","indexOf","sslCode","sslMessage","hasSslCode","hasSslMessage","hasStringProperty","obj","property","errors","errorMessage","info"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * Copyright 2014 IBM Corp. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar axios_1 = require(\"axios\");\nvar axios_cookiejar_support_1 = require(\"axios-cookiejar-support\");\nvar extend = require(\"extend\");\nvar FormData = require(\"form-data\");\nvar https = require(\"https\");\nvar isStream = require(\"isstream\");\nvar querystring = require(\"querystring\");\nvar zlib = require(\"zlib\");\nvar helper_1 = require(\"./helper\");\nvar logger_1 = require(\"./logger\");\nvar stream_to_promise_1 = require(\"./stream-to-promise\");\nvar isBrowser = typeof window === 'object';\nvar globalTransactionId = 'x-global-transaction-id';\nvar RequestWrapper = /** @class */ (function () {\n    function RequestWrapper(axiosOptions) {\n        axiosOptions = axiosOptions || {};\n        this.compressRequestData = Boolean(axiosOptions.enableGzipCompression);\n        // override several axios defaults\n        // axios sets the default Content-Type for `post`, `put`, and `patch` operations\n        // to 'application/x-www-form-urlencoded'. This causes problems, so overriding the\n        // defaults here\n        var axiosConfig = {\n            maxContentLength: Infinity,\n            headers: {\n                post: {\n                    'Content-Type': 'application/json'\n                },\n                put: {\n                    'Content-Type': 'application/json'\n                },\n                patch: {\n                    'Content-Type': 'application/json'\n                },\n            }\n        };\n        // merge axios config into default\n        extend(true, axiosConfig, axiosOptions);\n        // if the user explicitly sets `disableSslVerification` to true,\n        // `rejectUnauthorized` must be set to false in the https agent\n        if (axiosOptions.disableSslVerification === true) {\n            // the user may have already provided a custom agent. if so, update it\n            if (axiosConfig.httpsAgent) {\n                // check for presence of `options` field for \"type safety\"\n                if (axiosConfig.httpsAgent.options) {\n                    axiosConfig.httpsAgent.options.rejectUnauthorized = false;\n                }\n            }\n            else {\n                // if no agent is present, create a new one\n                axiosConfig.httpsAgent = new https.Agent({\n                    rejectUnauthorized: false,\n                });\n            }\n        }\n        this.axiosInstance = axios_1.default.create(axiosConfig);\n        // if a cookie jar is provided, wrap the axios instance and update defaults\n        if (axiosOptions.jar) {\n            axios_cookiejar_support_1.default(this.axiosInstance);\n            this.axiosInstance.defaults.withCredentials = true;\n            this.axiosInstance.defaults.jar = axiosOptions.jar;\n        }\n        // set debug interceptors\n        if (process.env.NODE_DEBUG === 'axios' || process.env.DEBUG) {\n            this.axiosInstance.interceptors.request.use(function (config) {\n                logger_1.default.debug('Request:');\n                try {\n                    logger_1.default.debug(JSON.stringify(config, null, 2));\n                }\n                catch (_a) {\n                    logger_1.default.error(config);\n                }\n                return config;\n            }, function (error) {\n                logger_1.default.error('Error: ');\n                try {\n                    logger_1.default.error(JSON.stringify(error, null, 2));\n                }\n                catch (_a) {\n                    logger_1.default.error(error);\n                }\n                return Promise.reject(error);\n            });\n            this.axiosInstance.interceptors.response.use(function (response) {\n                logger_1.default.debug('Response:');\n                try {\n                    logger_1.default.debug(JSON.stringify(response, null, 2));\n                }\n                catch (_a) {\n                    logger_1.default.error(response);\n                }\n                return response;\n            }, function (error) {\n                logger_1.default.error('Error: ');\n                try {\n                    logger_1.default.error(JSON.stringify(error, null, 2));\n                }\n                catch (_a) {\n                    logger_1.default.error(error);\n                }\n                return Promise.reject(error);\n            });\n        }\n    }\n    /**\n     * Creates the request.\n     * 1. Merge default options with user provided options\n     * 2. Checks for missing parameters\n     * 3. Encode path and query parameters\n     * 4. Call the api\n     * @private\n     * @returns {ReadableStream|undefined}\n     * @throws {Error}\n     */\n    RequestWrapper.prototype.sendRequest = function (parameters) {\n        return __awaiter(this, void 0, void 0, function () {\n            var options, path, body, form, formData, qs, method, serviceUrl, headers, url, multipartForm, data, requestParams;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        options = extend(true, {}, parameters.defaultOptions, parameters.options);\n                        path = options.path, body = options.body, form = options.form, formData = options.formData, qs = options.qs, method = options.method, serviceUrl = options.serviceUrl;\n                        headers = options.headers, url = options.url;\n                        multipartForm = new FormData();\n                        // Form params\n                        if (formData) {\n                            Object.keys(formData).forEach(function (key) {\n                                var values = Array.isArray(formData[key]) ? formData[key] : [formData[key]];\n                                // Skip keys with undefined/null values or empty object value\n                                values.filter(function (v) { return v != null && !helper_1.isEmptyObject(v); }).forEach(function (value) {\n                                    // Special case of empty file object\n                                    if (value.hasOwnProperty('contentType') && !value.hasOwnProperty('data')) {\n                                        return;\n                                    }\n                                    if (helper_1.isFileWithMetadata(value)) {\n                                        var fileObj = helper_1.buildRequestFileObject(value);\n                                        multipartForm.append(key, fileObj.value, fileObj.options);\n                                    }\n                                    else {\n                                        if (typeof value === 'object' && !helper_1.isFileData(value)) {\n                                            value = JSON.stringify(value);\n                                        }\n                                        multipartForm.append(key, value);\n                                    }\n                                });\n                            });\n                        }\n                        // Path params\n                        url = parsePath(url, path);\n                        // Headers\n                        options.headers = Object.assign({}, options.headers);\n                        // Convert array-valued query params to strings\n                        if (qs && Object.keys(qs).length > 0) {\n                            Object.keys(qs).forEach(function (key) { return Array.isArray(qs[key]) && (qs[key] = qs[key].join(',')); });\n                        }\n                        // Add service default endpoint if options.url start with /\n                        if (url && url.charAt(0) === '/') {\n                            url = helper_1.stripTrailingSlash(serviceUrl) + url;\n                        }\n                        url = helper_1.stripTrailingSlash(url);\n                        data = body;\n                        if (form) {\n                            data = querystring.stringify(form);\n                            headers['Content-type'] = 'application/x-www-form-urlencoded';\n                        }\n                        if (formData) {\n                            data = multipartForm;\n                            // form-data generates headers that MUST be included or the request will fail\n                            headers = extend(true, {}, headers, multipartForm.getHeaders());\n                        }\n                        // accept gzip encoded responses if Accept-Encoding is not already set\n                        headers['Accept-Encoding'] = headers['Accept-Encoding'] || 'gzip';\n                        if (!this.compressRequestData) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.gzipRequestBody(data, headers)];\n                    case 1:\n                        data = _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        requestParams = {\n                            url: url,\n                            method: method,\n                            headers: headers,\n                            params: qs,\n                            data: data,\n                            responseType: options.responseType || 'json',\n                            paramsSerializer: function (params) {\n                                return querystring.stringify(params);\n                            },\n                        };\n                        return [2 /*return*/, this.axiosInstance(requestParams).then(function (res) {\n                                // sometimes error responses will still trigger the `then` block - escape that behavior here\n                                if (!res) {\n                                    return;\n                                }\n                                ;\n                                // these objects contain circular json structures and are not always relevant to the user\n                                // if the user wants them, they can be accessed through the debug properties\n                                delete res.config;\n                                delete res.request;\n                                // the other sdks use the interface `result` for the body\n                                res.result = res.data;\n                                delete res.data;\n                                // return another promise that resolves with 'res' to be handled in generated code\n                                return res;\n                            }, function (err) {\n                                // return another promise that rejects with 'err' to be handled in generated code\n                                throw _this.formatError(err);\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * Format error returned by axios\n     * @param  {object} the object returned by axios via rejection\n     * @private\n     * @returns {Error}\n     */\n    RequestWrapper.prototype.formatError = function (axiosError) {\n        // return an actual error object,\n        // but make it flexible so we can add properties like 'body'\n        var error = new Error();\n        // axios specific handling\n        // this branch is for an error received from the service\n        if (axiosError.response) {\n            axiosError = axiosError.response;\n            // The request was made and the server responded with a status code\n            // that falls out of the range of 2xx\n            delete axiosError.config;\n            delete axiosError.request;\n            error.statusText = axiosError.statusText;\n            error.name = axiosError.statusText; // ** deprecated **\n            error.status = axiosError.status;\n            error.code = axiosError.status; // ** deprecated **\n            error.message = parseServiceErrorMessage(axiosError.data) || axiosError.statusText;\n            // some services bury the useful error message within 'data'\n            // adding it to the error under the key 'body' as a string or object\n            var errorBody = void 0;\n            try {\n                // try/catch to handle objects with circular references\n                errorBody = JSON.stringify(axiosError.data);\n            }\n            catch (e) {\n                // ignore the error, use the object, and tack on a warning\n                errorBody = axiosError.data;\n                errorBody.warning = 'Body contains circular reference';\n                logger_1.default.error(\"Failed to stringify axiosError: \" + e);\n            }\n            error.body = errorBody;\n            // attach headers to error object\n            error.headers = axiosError.headers;\n            // print a more descriptive error message for auth issues\n            if (isAuthenticationError(axiosError)) {\n                error.message = 'Access is denied due to invalid credentials.';\n            }\n        }\n        else if (axiosError.request) {\n            // The request was made but no response was received\n            // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n            // http.ClientRequest in node.js\n            error.message = axiosError.message;\n            error.statusText = axiosError.code;\n            error.body = 'Response not received - no connection was made to the service.';\n            // when a request to a private cloud instance has an ssl problem, it never connects and follows this branch of the error handling\n            if (isSelfSignedCertificateError(axiosError)) {\n                error.message = \"The connection failed because the SSL certificate is not valid. \" +\n                    \"To use a self-signed certificate, set the `disableSslVerification` parameter in the constructor options.\";\n            }\n        }\n        else {\n            // Something happened in setting up the request that triggered an Error\n            error.message = axiosError.message;\n        }\n        return error;\n    };\n    RequestWrapper.prototype.gzipRequestBody = function (data, headers) {\n        return __awaiter(this, void 0, void 0, function () {\n            var contentSetToGzip, reqBuffer, _a, _b, err_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        contentSetToGzip = headers['Content-Encoding'] &&\n                            headers['Content-Encoding'].toString().includes('gzip');\n                        if (!data || contentSetToGzip) {\n                            return [2 /*return*/, data];\n                        }\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 5, , 6]);\n                        if (!isStream(data)) return [3 /*break*/, 3];\n                        _b = (_a = Buffer).from;\n                        return [4 /*yield*/, stream_to_promise_1.streamToPromise(data)];\n                    case 2:\n                        reqBuffer = _b.apply(_a, [_c.sent()]);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        if (data.toString && data.toString() !== '[object Object]' && !Array.isArray(data)) {\n                            // this handles pretty much any primitive that isnt a JSON object or array\n                            reqBuffer = Buffer.from(data.toString());\n                        }\n                        else {\n                            reqBuffer = Buffer.from(JSON.stringify(data));\n                        }\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _c.sent();\n                        logger_1.default.error('Error converting request body to a buffer - data will not be compressed.');\n                        logger_1.default.debug(err_1);\n                        return [2 /*return*/, data];\n                    case 6:\n                        try {\n                            data = zlib.gzipSync(reqBuffer);\n                            // update the headers by reference - only if the data was actually compressed\n                            headers['Content-Encoding'] = 'gzip';\n                        }\n                        catch (err) {\n                            // if an exception is caught, `data` will still be in its original form\n                            // we can just proceed with the request uncompressed\n                            logger_1.default.error('Error compressing request body - data will not be compressed.');\n                            logger_1.default.debug(err);\n                        }\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    return RequestWrapper;\n}());\nexports.RequestWrapper = RequestWrapper;\n/**\n * @private\n * @param {string} path\n * @param {Object} params\n * @returns {string}\n */\nfunction parsePath(path, params) {\n    if (!path || !params) {\n        return path;\n    }\n    return Object.keys(params).reduce(function (parsedPath, param) {\n        var value = encodeURIComponent(params[param]);\n        return parsedPath.replace(new RegExp(\"{\" + param + \"}\"), value);\n    }, path);\n}\n/**\n * Determine if the error is due to bad credentials\n * @private\n * @param {Object} error - error object returned from axios\n * @returns {boolean} true if error is due to authentication\n */\nfunction isAuthenticationError(error) {\n    var isAuthErr = false;\n    var code = error.status || null;\n    var body = error.data || {};\n    // handle specific error from iam service, should be relevant across platforms\n    var isIamServiceError = body.context &&\n        body.context.url &&\n        body.context.url.indexOf('iam') > -1;\n    if (code === 401 || code === 403 || isIamServiceError) {\n        isAuthErr = true;\n    }\n    return isAuthErr;\n}\n/**\n * Determine if the error is due to a bad self signed certificate\n * @private\n * @param {Object} error - error object returned from axios\n * @returns {boolean} true if error is due to an SSL error\n */\nfunction isSelfSignedCertificateError(error) {\n    var result = false;\n    var sslCode = 'DEPTH_ZERO_SELF_SIGNED_CERT';\n    var sslMessage = 'self signed certificate';\n    var hasSslCode = error.code === sslCode;\n    var hasSslMessage = hasStringProperty(error, 'message') && error.message.includes(sslMessage);\n    if (hasSslCode || hasSslMessage) {\n        result = true;\n    }\n    return result;\n}\n/**\n * Return true if object has a specified property that is a string\n * @private\n * @param {Object} obj - object to look for property in\n * @param {string} property - name of the property to look for\n * @returns {boolean} true if property exists and is string\n */\nfunction hasStringProperty(obj, property) {\n    return Boolean(obj[property] && typeof obj[property] === 'string');\n}\n/**\n * Look for service error message in common places, by priority\n * first look in `errors[0].message`, then in `error`, then in\n * `message`, then in `errorMessage`\n * @private\n * @param {Object} response - error response body received from service\n * @returns {string | undefined} the error message if is was found, undefined otherwise\n */\nfunction parseServiceErrorMessage(response) {\n    var message;\n    if (Array.isArray(response.errors) && response.errors.length > 0 && hasStringProperty(response.errors[0], 'message')) {\n        message = response.errors[0].message;\n    }\n    else if (hasStringProperty(response, 'error')) {\n        message = response.error;\n    }\n    else if (hasStringProperty(response, 'message')) {\n        message = response.message;\n    }\n    else if (hasStringProperty(response, 'errorMessage')) {\n        message = response.errorMessage;\n    }\n    logger_1.default.info(\"Parsing service error message: \" + message);\n    return message;\n}\n"]},"metadata":{},"sourceType":"script"}